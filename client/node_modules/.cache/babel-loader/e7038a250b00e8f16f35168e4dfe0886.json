{"ast":null,"code":"import axios from \"axios\";\nconst API_URL = \"https://jwt-chat.herokuapp.com/api\";\nconst SERVER_URL = \"https://jwt-chat.herokuapp.com\"; // const API_URL = \"http://localhost:5000/api\"\n// const SERVER_URL = \"http://localhost:5000\"\n\nexport { API_URL, SERVER_URL };\nconst api = axios.create({\n  withCredentials: true,\n  headers: {\n    \"Access-Control-Allow-Origin\": \"*\"\n  },\n  baseURL: API_URL\n});\napi.interceptors.request.use(config => {\n  config.headers.Authorization = `Bearer ${localStorage.getItem(\"token\")}`;\n  return config;\n});\napi.interceptors.response.use(config => {\n  return config;\n}, async error => {\n  const originalRequest = error.config;\n\n  if (error.response.status == 401 && error.config && !originalRequest._isRetry) {\n    originalRequest._isRetry = true;\n\n    try {\n      const res = await axios.get(`${API_URL}/refresh`, {\n        withCredentials: true\n      });\n      const accessToken = res.data.accessToken;\n      localStorage.setItem(\"token\", accessToken);\n      return api.request(originalRequest);\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  throw error;\n});\nexport default api;","map":{"version":3,"names":["axios","API_URL","SERVER_URL","api","create","withCredentials","headers","baseURL","interceptors","request","use","config","Authorization","localStorage","getItem","response","error","originalRequest","status","_isRetry","res","get","accessToken","data","setItem","e","console","log"],"sources":["C:/Users/DENI/Desktop/код/vsCode/authJWT/client/src/http/index.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst API_URL = \"https://jwt-chat.herokuapp.com/api\"\r\nconst SERVER_URL = \"https://jwt-chat.herokuapp.com\"\r\n// const API_URL = \"http://localhost:5000/api\"\r\n// const SERVER_URL = \"http://localhost:5000\"\r\n\r\nexport {API_URL, SERVER_URL}\r\n\r\nconst api = axios.create({\r\n    withCredentials: true,\r\n    headers: {\r\n        \"Access-Control-Allow-Origin\": \"*\"  \r\n    },\r\n    baseURL: API_URL\r\n})\r\n\r\napi.interceptors.request.use((config) => {\r\n    config.headers.Authorization = `Bearer ${localStorage.getItem(\"token\")}`\r\n    return config\r\n})\r\n\r\napi.interceptors.response.use((config) => {\r\n    return config\r\n}, async (error) => {\r\n    const originalRequest = error.config\r\n    if (error.response.status == 401 && error.config && !originalRequest._isRetry) {\r\n        originalRequest._isRetry = true\r\n        try {\r\n            const res = await axios.get(`${API_URL}/refresh`, {withCredentials: true})\r\n            const accessToken = res.data.accessToken\r\n            localStorage.setItem(\"token\", accessToken)\r\n            return api.request(originalRequest)\r\n        } catch(e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n    throw error\r\n})\r\n\r\nexport default api"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,MAAMC,OAAO,GAAG,oCAAhB;AACA,MAAMC,UAAU,GAAG,gCAAnB,C,CACA;AACA;;AAEA,SAAQD,OAAR,EAAiBC,UAAjB;AAEA,MAAMC,GAAG,GAAGH,KAAK,CAACI,MAAN,CAAa;EACrBC,eAAe,EAAE,IADI;EAErBC,OAAO,EAAE;IACL,+BAA+B;EAD1B,CAFY;EAKrBC,OAAO,EAAEN;AALY,CAAb,CAAZ;AAQAE,GAAG,CAACK,YAAJ,CAAiBC,OAAjB,CAAyBC,GAAzB,CAA8BC,MAAD,IAAY;EACrCA,MAAM,CAACL,OAAP,CAAeM,aAAf,GAAgC,UAASC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B,EAAvE;EACA,OAAOH,MAAP;AACH,CAHD;AAKAR,GAAG,CAACK,YAAJ,CAAiBO,QAAjB,CAA0BL,GAA1B,CAA+BC,MAAD,IAAY;EACtC,OAAOA,MAAP;AACH,CAFD,EAEG,MAAOK,KAAP,IAAiB;EAChB,MAAMC,eAAe,GAAGD,KAAK,CAACL,MAA9B;;EACA,IAAIK,KAAK,CAACD,QAAN,CAAeG,MAAf,IAAyB,GAAzB,IAAgCF,KAAK,CAACL,MAAtC,IAAgD,CAACM,eAAe,CAACE,QAArE,EAA+E;IAC3EF,eAAe,CAACE,QAAhB,GAA2B,IAA3B;;IACA,IAAI;MACA,MAAMC,GAAG,GAAG,MAAMpB,KAAK,CAACqB,GAAN,CAAW,GAAEpB,OAAQ,UAArB,EAAgC;QAACI,eAAe,EAAE;MAAlB,CAAhC,CAAlB;MACA,MAAMiB,WAAW,GAAGF,GAAG,CAACG,IAAJ,CAASD,WAA7B;MACAT,YAAY,CAACW,OAAb,CAAqB,OAArB,EAA8BF,WAA9B;MACA,OAAOnB,GAAG,CAACM,OAAJ,CAAYQ,eAAZ,CAAP;IACH,CALD,CAKE,OAAMQ,CAAN,EAAS;MACPC,OAAO,CAACC,GAAR,CAAYF,CAAZ;IACH;EACJ;;EACD,MAAMT,KAAN;AACH,CAhBD;AAkBA,eAAeb,GAAf"},"metadata":{},"sourceType":"module"}