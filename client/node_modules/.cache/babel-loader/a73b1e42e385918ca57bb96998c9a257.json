{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport api, { SERVER_URL } from \"../http/index\";\nimport io from \"socket.io-client\";\nconst socket = io.connect(SERVER_URL);\n\nfunction useRoom(setMembers, setMessage, setMessageHistory) {\n  _s();\n\n  const joinRoom = async (room, user) => {\n    socket.emit(\"join_room\", `room${room}`);\n    const membersAfterPost = await api.post(`/messages/room${room}/members`, {\n      user_id: user.id\n    }).then(res => res.data);\n    setMembers(membersAfterPost);\n    sendMessage();\n  };\n\n  const leaveRoom = async (room, user) => {\n    socket.emit(\"leave_room\", `room${room}`);\n    await api.delete(`/messages/room${room}/members?user=${user.id}`);\n    setMembers([]);\n  };\n\n  const sendMessage = (user, message, roomId, msgType) => {\n    if (message.replace(/\\s+/g, '').length === 0) return;\n    socket.emit(\"send_message\", {\n      userId: user.id,\n      name: user.name,\n      message,\n      room: `room${roomId}`,\n      type: msgType\n    });\n    setMessage(\"\");\n  };\n\n  useEffect(() => {\n    socket.on(\"receive_message\", data => {\n      setMessageHistory(prev => [data, ...prev]);\n    });\n  }, []);\n  return {\n    joinRoom,\n    leaveRoom,\n    sendMessage\n  };\n}\n\n_s(useRoom, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\nexport default useRoom;","map":{"version":3,"names":["useEffect","useState","api","SERVER_URL","io","socket","connect","useRoom","setMembers","setMessage","setMessageHistory","joinRoom","room","user","emit","membersAfterPost","post","user_id","id","then","res","data","sendMessage","leaveRoom","delete","message","roomId","msgType","replace","length","userId","name","type","on","prev"],"sources":["C:/Users/DENI/Desktop/код/vsCode/authJWT/client/src/hooks/useRoom.js"],"sourcesContent":["import { useEffect, useState } from \"react\"\r\n\r\nimport api, {SERVER_URL} from \"../http/index\"\r\nimport io from \"socket.io-client\"\r\nconst socket = io.connect(SERVER_URL)\r\n\r\n\r\nfunction useRoom(setMembers, setMessage, setMessageHistory) {\r\n    const joinRoom = async (room, user) => {\r\n        socket.emit(\"join_room\", `room${room}`)\r\n        const membersAfterPost = await api.post(`/messages/room${room}/members`, {user_id: user.id}).then(res => res.data)\r\n        setMembers(membersAfterPost)\r\n\r\n        sendMessage()\r\n    }\r\n\r\n    const leaveRoom = async (room, user) => {\r\n        socket.emit(\"leave_room\", `room${room}`)\r\n        await api.delete(`/messages/room${room}/members?user=${user.id}`)\r\n        setMembers([])\r\n    }\r\n      \r\n    const sendMessage = (user, message, roomId, msgType) => {\r\n        if (message.replace(/\\s+/g, '').length === 0) return\r\n        socket.emit(\"send_message\", {userId: user.id, name: user.name, message, room: `room${roomId}`, type: msgType})\r\n        setMessage(\"\")\r\n    }\r\n\r\n    useEffect(() => {\r\n        socket.on(\"receive_message\", (data) => {\r\n            setMessageHistory(prev => [data, ...prev])\r\n        })\r\n    }, [])\r\n\r\n    return {joinRoom, leaveRoom, sendMessage}\r\n}\r\n\r\nexport default useRoom"],"mappings":";;AAAA,SAASA,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AAEA,OAAOC,GAAP,IAAaC,UAAb,QAA8B,eAA9B;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,MAAMC,MAAM,GAAGD,EAAE,CAACE,OAAH,CAAWH,UAAX,CAAf;;AAGA,SAASI,OAAT,CAAiBC,UAAjB,EAA6BC,UAA7B,EAAyCC,iBAAzC,EAA4D;EAAA;;EACxD,MAAMC,QAAQ,GAAG,OAAOC,IAAP,EAAaC,IAAb,KAAsB;IACnCR,MAAM,CAACS,IAAP,CAAY,WAAZ,EAA0B,OAAMF,IAAK,EAArC;IACA,MAAMG,gBAAgB,GAAG,MAAMb,GAAG,CAACc,IAAJ,CAAU,iBAAgBJ,IAAK,UAA/B,EAA0C;MAACK,OAAO,EAAEJ,IAAI,CAACK;IAAf,CAA1C,EAA8DC,IAA9D,CAAmEC,GAAG,IAAIA,GAAG,CAACC,IAA9E,CAA/B;IACAb,UAAU,CAACO,gBAAD,CAAV;IAEAO,WAAW;EACd,CAND;;EAQA,MAAMC,SAAS,GAAG,OAAOX,IAAP,EAAaC,IAAb,KAAsB;IACpCR,MAAM,CAACS,IAAP,CAAY,YAAZ,EAA2B,OAAMF,IAAK,EAAtC;IACA,MAAMV,GAAG,CAACsB,MAAJ,CAAY,iBAAgBZ,IAAK,iBAAgBC,IAAI,CAACK,EAAG,EAAzD,CAAN;IACAV,UAAU,CAAC,EAAD,CAAV;EACH,CAJD;;EAMA,MAAMc,WAAW,GAAG,CAACT,IAAD,EAAOY,OAAP,EAAgBC,MAAhB,EAAwBC,OAAxB,KAAoC;IACpD,IAAIF,OAAO,CAACG,OAAR,CAAgB,MAAhB,EAAwB,EAAxB,EAA4BC,MAA5B,KAAuC,CAA3C,EAA8C;IAC9CxB,MAAM,CAACS,IAAP,CAAY,cAAZ,EAA4B;MAACgB,MAAM,EAAEjB,IAAI,CAACK,EAAd;MAAkBa,IAAI,EAAElB,IAAI,CAACkB,IAA7B;MAAmCN,OAAnC;MAA4Cb,IAAI,EAAG,OAAMc,MAAO,EAAhE;MAAmEM,IAAI,EAAEL;IAAzE,CAA5B;IACAlB,UAAU,CAAC,EAAD,CAAV;EACH,CAJD;;EAMAT,SAAS,CAAC,MAAM;IACZK,MAAM,CAAC4B,EAAP,CAAU,iBAAV,EAA8BZ,IAAD,IAAU;MACnCX,iBAAiB,CAACwB,IAAI,IAAI,CAACb,IAAD,EAAO,GAAGa,IAAV,CAAT,CAAjB;IACH,CAFD;EAGH,CAJQ,EAIN,EAJM,CAAT;EAMA,OAAO;IAACvB,QAAD;IAAWY,SAAX;IAAsBD;EAAtB,CAAP;AACH;;GA5BQf,O;;AA8BT,eAAeA,OAAf"},"metadata":{},"sourceType":"module"}