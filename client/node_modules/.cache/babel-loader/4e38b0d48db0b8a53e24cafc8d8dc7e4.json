{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/DENI/Desktop/\\u043A\\u043E\\u0434/vsCode/authJWT/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\DENI\\\\Desktop\\\\\\u043A\\u043E\\u0434\\\\vsCode\\\\authJWT\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import axios from\"axios\";export var API_URL=\"http://localhost:5000/api\";var api=axios.create({withCredentials:true,baseURL:API_URL});api.interceptors.request.use(function(config){config.headers.Authorization=\"Bearer \".concat(localStorage.getItem(\"token\"));return config;});api.interceptors.response.use(function(config){return config;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(error){var originalRequest,res,accessToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:originalRequest=error.config;if(!(error.response.status==401&&error.config&&!originalRequest._isRetry)){_context.next=15;break;}originalRequest._isRetry=true;_context.prev=3;_context.next=6;return axios.get(\"\".concat(API_URL,\"/refresh\"),{withCredentials:true});case 6:res=_context.sent;accessToken=res.data.accessToken;localStorage.setItem(\"token\",accessToken);return _context.abrupt(\"return\",api.request(originalRequest));case 12:_context.prev=12;_context.t0=_context[\"catch\"](3);console.log(_context.t0);case 15:throw error;case 16:case\"end\":return _context.stop();}}},_callee,null,[[3,12]]);}));return function(_x){return _ref.apply(this,arguments);};}());export default api;","map":{"version":3,"names":["axios","API_URL","api","create","withCredentials","baseURL","interceptors","request","use","config","headers","Authorization","localStorage","getItem","response","error","originalRequest","status","_isRetry","get","res","accessToken","data","setItem","console","log"],"sources":["C:/Users/DENI/Desktop/код/vsCode/authJWT/client/src/http/index.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nexport const API_URL = \"http://localhost:5000/api\"\r\n\r\nconst api = axios.create({\r\n    withCredentials: true,\r\n    baseURL: API_URL\r\n})\r\n\r\napi.interceptors.request.use((config) => {\r\n    config.headers.Authorization = `Bearer ${localStorage.getItem(\"token\")}`\r\n    return config\r\n})\r\n\r\napi.interceptors.response.use((config) => {\r\n    return config\r\n}, async (error) => {\r\n    const originalRequest = error.config\r\n    if (error.response.status == 401 && error.config && !originalRequest._isRetry) {\r\n        originalRequest._isRetry = true\r\n        try {\r\n            const res = await axios.get(`${API_URL}/refresh`, {withCredentials: true})\r\n            const accessToken = res.data.accessToken\r\n            localStorage.setItem(\"token\", accessToken)\r\n            return api.request(originalRequest)\r\n        } catch(e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n    throw error\r\n})\r\n\r\nexport default api"],"mappings":"uTAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CAEA,MAAO,IAAMC,CAAAA,OAAO,CAAG,2BAAhB,CAEP,GAAMC,CAAAA,GAAG,CAAGF,KAAK,CAACG,MAAN,CAAa,CACrBC,eAAe,CAAE,IADI,CAErBC,OAAO,CAAEJ,OAFY,CAAb,CAAZ,CAKAC,GAAG,CAACI,YAAJ,CAAiBC,OAAjB,CAAyBC,GAAzB,CAA6B,SAACC,MAAD,CAAY,CACrCA,MAAM,CAACC,OAAP,CAAeC,aAAf,kBAAyCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAzC,EACA,MAAOJ,CAAAA,MAAP,CACH,CAHD,EAKAP,GAAG,CAACI,YAAJ,CAAiBQ,QAAjB,CAA0BN,GAA1B,CAA8B,SAACC,MAAD,CAAY,CACtC,MAAOA,CAAAA,MAAP,CACH,CAFD,0FAEG,iBAAOM,KAAP,sJACOC,eADP,CACyBD,KAAK,CAACN,MAD/B,MAEKM,KAAK,CAACD,QAAN,CAAeG,MAAf,EAAyB,GAAzB,EAAgCF,KAAK,CAACN,MAAtC,EAAgD,CAACO,eAAe,CAACE,QAFtE,2BAGKF,eAAe,CAACE,QAAhB,CAA2B,IAA3B,CAHL,sCAK2BlB,CAAAA,KAAK,CAACmB,GAAN,WAAalB,OAAb,aAAgC,CAACG,eAAe,CAAE,IAAlB,CAAhC,CAL3B,QAKegB,GALf,eAMeC,WANf,CAM6BD,GAAG,CAACE,IAAJ,CAASD,WANtC,CAOST,YAAY,CAACW,OAAb,CAAqB,OAArB,CAA8BF,WAA9B,EAPT,gCAQgBnB,GAAG,CAACK,OAAJ,CAAYS,eAAZ,CARhB,4DAUSQ,OAAO,CAACC,GAAR,cAVT,aAaOV,CAAAA,KAbP,sEAFH,gEAkBA,cAAeb,CAAAA,GAAf"},"metadata":{},"sourceType":"module"}